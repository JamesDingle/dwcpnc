//
// Created by jad on 26/02/18.
//

#ifndef DWCPNC_PENGUIN_H
#define DWCPNC_PENGUIN_H

#include <stdlib.h>
#include <stdio.h>
#include <math.h>
#include "profile.h"
// scattering coefficient of pure seawater at 500nm
static const double BW500 = 0.00288;
static const double br488 = 0.00027;

// absorption coefficient of pure seawater
static const double AW[61] = {
        0.00663, 0.00530, 0.00473, 0.00444,
        0.00454, 0.00478, 0.00495, 0.00530,
        0.00635, 0.00751, 0.00922, 0.00962,
        0.00979, 0.01011, 0.0106, 0.0114,
        0.0127, 0.0136, 0.0150, 0.0173,
        0.0204, 0.0256, 0.0325, 0.0396,
        0.0409, 0.0417, 0.0434, 0.0452,
        0.0474, 0.0511, 0.0565, 0.0596,
        0.0619, 0.0642, 0.0695, 0.0772,
        0.0896, 0.1100, 0.1351, 0.1672,
        0.2224, 0.2577, 0.2644, 0.2678,
        0.2755, 0.2834, 0.2916, 0.3012,
        0.3108, 0.325, 0.340, 0.371,
        0.410, 0.429, 0.439, 0.448,
        0.465, 0.486, 0.516, 0.559, 0.624
};

static const double PC1[61] = {
        0.047944, 0.051486, 0.054383, 0.056347, 0.056745, 0.057034, 0.058144, 0.05964, 0.058356, 0.054606, 0.050313,
        0.048452, 0.048273, 0.048178, 0.047131, 0.044843, 0.04204, 0.03852, 0.035078, 0.031022, 0.026964, 0.023036,
        0.019536, 0.016517, 0.014005, 0.01183, 0.009916, 0.008453, 0.007296, 0.00634, 0.00538, 0.00445, 0.003657,
        0.003186,
        0.002969, 0.003008, 0.003264, 0.003673, 0.004131, 0.004329, 0.00422, 0.003967, 0.003673, 0.003584, 0.003707,
        0.003754, 0.004042, 0.004425, 0.005037, 0.005738, 0.005899, 0.005857, 0.006762, 0.00968, 0.013426, 0.015434,
        0.01451, 0.009734, 0.00483, 0.002587, 0.00204
};

static const double PC2[61] = {
        0.020423, 0.020797, 0.02153, 0.021775, 0.021679, 0.021509, 0.021798, 0.022315, 0.022192, 0.021124, 0.019786,
        0.018766, 0.017943, 0.017007, 0.015666, 0.014284, 0.01308, 0.012464, 0.012088, 0.011885, 0.011534, 0.011123,
        0.010719, 0.0103, 0.009882, 0.009532, 0.009208, 0.008798, 0.00835, 0.007807, 0.007167, 0.006493, 0.005868,
        0.005399, 0.005148, 0.005034, 0.005074, 0.00512, 0.005014, 0.004772, 0.004541, 0.004633, 0.005071, 0.005604,
        0.005975, 0.006203, 0.00639, 0.006543, 0.006368, 0.005994, 0.00613, 0.007297, 0.00978, 0.013016, 0.015776,
        0.016276, 0.014089, 0.010754, 0.007146, 0.004245, 0.00251
};

static const double RATE[61] = {
        1.205002, 1.220828, 1.277448, 1.342184, 1.406491, 1.465066, 1.538236, 1.606021, 1.681225, 1.731006, 1.776641,
        1.777083, 1.774193, 1.778021, 1.798992, 1.825786, 1.834832, 1.870123, 1.856917, 1.842261, 1.808863, 1.802813,
        1.824051, 1.844891, 1.853456, 1.880783, 1.939347, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 1.992925, 1.995062, 2,
        2,2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 1.921015, 1.784356, 1.695164, 1.534441, 1.242857
};

typedef struct {
    double *par_profile;
    double *pp_profile;
    double euphotic_depth;
    int euphotic_depth_index;
    int success;
} pp_result_t;

double* calc_bw(wavelength_array_t* wl_array);
double* calc_bbr(wavelength_array_t* wl_array);
double* calc_ay(wavelength_array_t* wl_array);

pp_result_t* compute_pp_along_profile(
        depth_profile_t *chl_profile,
        wavelength_array_t *wl_array,
        double zenith_r,
        double *direct,
        double *diffuse,
        double *bw,
        double *ay,
        double *bbr,
        double alpha_b,
        double pmb,
        double yelsub
);

#endif //DWCPNC_PENGUIN_H
